<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AIå»æ°´å°å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-bottom: 20px;
        }

        .container {
            max-width: 100%;
            padding: 15px;
        }

        /* å¤´éƒ¨ */
        .header {
            text-align: center;
            padding: 20px 0;
            color: white;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* åŠŸèƒ½åˆ‡æ¢æ ‡ç­¾ */
        .tab-container {
            display: flex;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            color: white;
            font-size: 14px;
            font-weight: 500;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* å†…å®¹å¡ç‰‡ */
        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title .icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: #e8eeff;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .upload-text {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .upload-hint {
            font-size: 12px;
            color: #999;
        }

        .file-input {
            display: none;
        }

        /* æ–‡ä»¶é¢„è§ˆ */
        .file-preview {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .file-preview.show {
            display: block;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-icon {
            font-size: 32px;
        }

        .file-details {
            flex: 1;
        }

        .file-name {
            font-size: 14px;
            color: #333;
            font-weight: 500;
            word-break: break-all;
        }

        .file-size {
            font-size: 12px;
            color: #999;
            margin-top: 2px;
        }

        .file-remove {
            width: 28px;
            height: 28px;
            border: none;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* é€‰é¡¹åŒºåŸŸ */
        .options {
            margin-top: 15px;
        }

        .option-label {
            font-size: 14px;
            color: #333;
            margin-bottom: 10px;
            display: block;
        }

        .orientation-selector {
            display: flex;
            gap: 10px;
        }

        .orientation-option {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .orientation-option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .orientation-option .icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .orientation-option .text {
            font-size: 12px;
            color: #666;
        }

        /* æŒ‰é’® */
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* è¿›åº¦åŒºåŸŸ */
        .progress-area {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            text-align: center;
        }

        .progress-area.show {
            display: block;
        }

        .progress-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e0e0e0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .progress-text {
            font-size: 14px;
            color: #333;
            margin-bottom: 5px;
        }

        .progress-status {
            font-size: 12px;
            color: #667eea;
        }

        /* ç»“æœåŒºåŸŸ */
        .result-area {
            display: none;
            margin-top: 20px;
        }

        .result-area.show {
            display: block;
        }

        .result-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .result-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .result-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .result-actions {
            display: flex;
            gap: 10px;
        }

        .btn-download {
            flex: 1;
            padding: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
        }

        /* æç¤ºä¿¡æ¯ */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.error {
            background: #ff4757;
        }

        .toast.success {
            background: #2ed573;
        }

        /* éšè—çš„å†…å®¹ */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ¨ AIå»æ°´å°å·¥å…·</h1>
            <p>æ™ºèƒ½å»é™¤è§†é¢‘å’Œå›¾ç‰‡æ°´å°</p>
        </div>

        <!-- å¯¼èˆªé“¾æ¥ -->
        <div class="nav-links" style="display: flex; justify-content: center; gap: 15px; margin-bottom: 20px;">
            <a href="/pose" class="nav-link" style="color: white; text-decoration: none; font-size: 14px; padding: 8px 16px; background: rgba(255, 255, 255, 0.2); border-radius: 20px; backdrop-filter: blur(10px); transition: all 0.3s ease;">ğŸ’ƒ æ”¹å˜äººç‰©åŠ¨ä½œ â†’</a>
        </div>

        <!-- åŠŸèƒ½åˆ‡æ¢æ ‡ç­¾ -->
        <div class="tab-container">
            <div class="tab active" data-tab="video">ğŸ¬ è§†é¢‘å»æ°´å°</div>
            <div class="tab" data-tab="image">ğŸ–¼ï¸ å›¾ç‰‡å»æ°´å°</div>
        </div>

        <!-- è§†é¢‘å»æ°´å° -->
        <div id="video-section" class="content-section active">
            <div class="card">
                <div class="card-title">
                    <div class="icon">ğŸ¬</div>
                    ä¸Šä¼ è§†é¢‘
                </div>

                <div class="upload-area" id="video-upload">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ è§†é¢‘</div>
                    <div class="upload-hint">æ”¯æŒ MP4, AVI, MOV, MKV æ ¼å¼</div>
                </div>
                <input type="file" class="file-input" id="video-input" accept="video/*">

                <div class="file-preview" id="video-preview">
                    <div class="file-info">
                        <div class="file-icon">ğŸ¬</div>
                        <div class="file-details">
                            <div class="file-name" id="video-filename"></div>
                            <div class="file-size" id="video-filesize"></div>
                        </div>
                        <button class="file-remove" id="video-remove">Ã—</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <div class="icon">âš™ï¸</div>
                    è§†é¢‘æ–¹å‘
                </div>
                <div class="options">
                    <label class="option-label">é€‰æ‹©è§†é¢‘æ–¹å‘ï¼ˆé»˜è®¤ç«–å±ï¼‰</label>
                    <div class="orientation-selector">
                        <div class="orientation-option selected" data-orientation="portrait">
                            <div class="icon">ğŸ“±</div>
                            <div class="text">ç«–å± 9:16</div>
                        </div>
                        <div class="orientation-option" data-orientation="landscape">
                            <div class="icon">ğŸ“º</div>
                            <div class="text">æ¨ªå± 16:9</div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" id="video-submit" disabled>
                å¼€å§‹å»æ°´å°
            </button>

            <div class="progress-area" id="video-progress">
                <div class="progress-spinner"></div>
                <div class="progress-text">æ­£åœ¨å¤„ç†ä¸­...</div>
                <div class="progress-status" id="video-status">å‡†å¤‡ä¸Šä¼ </div>
            </div>

            <div class="result-area" id="video-result">
                <div class="result-title">âœ… å¤„ç†å®Œæˆ</div>
                <div id="video-result-list"></div>
            </div>
        </div>

        <!-- å›¾ç‰‡å»æ°´å° -->
        <div id="image-section" class="content-section">
            <div class="card">
                <div class="card-title">
                    <div class="icon">ğŸ–¼ï¸</div>
                    ä¸Šä¼ å›¾ç‰‡
                </div>

                <div class="upload-area" id="image-upload">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡</div>
                    <div class="upload-hint">æ”¯æŒ PNG, JPG, JPEG, GIF, BMP æ ¼å¼</div>
                </div>
                <input type="file" class="file-input" id="image-input" accept="image/*">

                <div class="file-preview" id="image-preview">
                    <div class="file-info">
                        <div class="file-icon">ğŸ–¼ï¸</div>
                        <div class="file-details">
                            <div class="file-name" id="image-filename"></div>
                            <div class="file-size" id="image-filesize"></div>
                        </div>
                        <button class="file-remove" id="image-remove">Ã—</button>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" id="image-submit" disabled>
                å¼€å§‹å»æ°´å°
            </button>

            <div class="progress-area" id="image-progress">
                <div class="progress-spinner"></div>
                <div class="progress-text">æ­£åœ¨å¤„ç†ä¸­...</div>
                <div class="progress-status" id="image-status">å‡†å¤‡ä¸Šä¼ </div>
            </div>

            <div class="result-area" id="image-result">
                <div class="result-title">âœ… å¤„ç†å®Œæˆ</div>
                <div id="image-result-list"></div>
            </div>
        </div>
    </div>

    <!-- æç¤ºä¿¡æ¯ -->
    <div class="toast" id="toast"></div>

    <script>
        // å…¨å±€å˜é‡
        let currentTab = 'video';
        let selectedVideoFile = null;
        let selectedImageFile = null;
        let videoOrientation = 'portrait';
        let currentTaskId = null;

        // DOMå…ƒç´ 
        const tabs = document.querySelectorAll('.tab');
        const sections = document.querySelectorAll('.content-section');
        const toast = document.getElementById('toast');

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initTabs();
            initVideoUpload();
            initImageUpload();
            initOrientationSelector();
        });

        // æ ‡ç­¾åˆ‡æ¢
        function initTabs() {
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    switchTab(tabName);
                });
            });
        }

        function switchTab(tabName) {
            currentTab = tabName;
            
            tabs.forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tabName);
            });
            
            sections.forEach(s => {
                s.classList.toggle('active', s.id === `${tabName}-section`);
            });
        }

        // è§†é¢‘ä¸Šä¼ 
        function initVideoUpload() {
            const uploadArea = document.getElementById('video-upload');
            const fileInput = document.getElementById('video-input');
            const preview = document.getElementById('video-preview');
            const filename = document.getElementById('video-filename');
            const filesize = document.getElementById('video-filesize');
            const removeBtn = document.getElementById('video-remove');
            const submitBtn = document.getElementById('video-submit');

            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleVideoFile(files[0]);
                }
            });

            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleVideoFile(e.target.files[0]);
                }
            });

            removeBtn.addEventListener('click', () => {
                selectedVideoFile = null;
                fileInput.value = '';
                preview.classList.remove('show');
                uploadArea.style.display = 'block';
                submitBtn.disabled = true;
            });

            submitBtn.addEventListener('click', () => {
                if (selectedVideoFile) {
                    processVideo();
                }
            });

            function handleVideoFile(file) {
                const allowedTypes = ['video/mp4', 'video/avi', 'video/mov', 'video/quicktime', 'video/x-matroska'];
                const allowedExts = ['mp4', 'avi', 'mov', 'mkv'];
                const ext = file.name.split('.').pop().toLowerCase();

                if (!allowedExts.includes(ext)) {
                    showToast('ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹', 'error');
                    return;
                }

                selectedVideoFile = file;
                filename.textContent = file.name;
                filesize.textContent = formatFileSize(file.size);
                preview.classList.add('show');
                uploadArea.style.display = 'none';
                submitBtn.disabled = false;
            }
        }

        // å›¾ç‰‡ä¸Šä¼ 
        function initImageUpload() {
            const uploadArea = document.getElementById('image-upload');
            const fileInput = document.getElementById('image-input');
            const preview = document.getElementById('image-preview');
            const filename = document.getElementById('image-filename');
            const filesize = document.getElementById('image-filesize');
            const removeBtn = document.getElementById('image-remove');
            const submitBtn = document.getElementById('image-submit');

            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleImageFile(files[0]);
                }
            });

            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleImageFile(e.target.files[0]);
                }
            });

            removeBtn.addEventListener('click', () => {
                selectedImageFile = null;
                fileInput.value = '';
                preview.classList.remove('show');
                uploadArea.style.display = 'block';
                submitBtn.disabled = true;
            });

            submitBtn.addEventListener('click', () => {
                if (selectedImageFile) {
                    processImage();
                }
            });

            function handleImageFile(file) {
                const allowedExts = ['png', 'jpg', 'jpeg', 'gif', 'bmp'];
                const ext = file.name.split('.').pop().toLowerCase();

                if (!allowedExts.includes(ext)) {
                    showToast('ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹', 'error');
                    return;
                }

                selectedImageFile = file;
                filename.textContent = file.name;
                filesize.textContent = formatFileSize(file.size);
                preview.classList.add('show');
                uploadArea.style.display = 'none';
                submitBtn.disabled = false;
            }
        }

        // æ–¹å‘é€‰æ‹©
        function initOrientationSelector() {
            const options = document.querySelectorAll('.orientation-option');
            options.forEach(option => {
                option.addEventListener('click', () => {
                    options.forEach(o => o.classList.remove('selected'));
                    option.classList.add('selected');
                    videoOrientation = option.dataset.orientation;
                });
            });
        }

        // å¤„ç†è§†é¢‘
        async function processVideo() {
            const progressArea = document.getElementById('video-progress');
            const statusText = document.getElementById('video-status');
            const resultArea = document.getElementById('video-result');
            const submitBtn = document.getElementById('video-submit');

            submitBtn.disabled = true;
            progressArea.classList.add('show');
            resultArea.classList.remove('show');

            try {
                // 1. ä¸Šä¼ æ–‡ä»¶
                statusText.textContent = 'æ­£åœ¨ä¸Šä¼ è§†é¢‘...';
                const uploadResult = await uploadFile(selectedVideoFile, 'video');
                
                if (uploadResult.code !== 0) {
                    throw new Error(uploadResult.msg || 'ä¸Šä¼ å¤±è´¥');
                }

                const fileName = uploadResult.data.fileName;
                showToast('ä¸Šä¼ æˆåŠŸ', 'success');

                // 2. åˆ›å»ºä»»åŠ¡
                statusText.textContent = 'æ­£åœ¨åˆ›å»ºä»»åŠ¡...';
                const taskResult = await createTask(fileName, 'video', videoOrientation);
                
                if (taskResult.code !== 0) {
                    throw new Error(taskResult.msg || 'åˆ›å»ºä»»åŠ¡å¤±è´¥');
                }

                currentTaskId = taskResult.data.taskId;
                showToast('ä»»åŠ¡åˆ›å»ºæˆåŠŸ', 'success');

                // 3. è½®è¯¢çŠ¶æ€
                statusText.textContent = 'æ­£åœ¨å¤„ç†ä¸­...';
                const outputs = await pollTaskStatus(currentTaskId, (status) => {
                    statusText.textContent = `ä»»åŠ¡çŠ¶æ€: ${getStatusText(status)}`;
                });

                // 4. æ˜¾ç¤ºç»“æœ
                progressArea.classList.remove('show');
                displayVideoResults(outputs);
                resultArea.classList.add('show');
                showToast('å¤„ç†å®Œæˆ', 'success');

            } catch (error) {
                progressArea.classList.remove('show');
                submitBtn.disabled = false;
                showToast(error.message || 'å¤„ç†å¤±è´¥', 'error');
                console.error(error);
            }
        }

        // å¤„ç†å›¾ç‰‡
        async function processImage() {
            const progressArea = document.getElementById('image-progress');
            const statusText = document.getElementById('image-status');
            const resultArea = document.getElementById('image-result');
            const submitBtn = document.getElementById('image-submit');

            submitBtn.disabled = true;
            progressArea.classList.add('show');
            resultArea.classList.remove('show');

            try {
                // 1. ä¸Šä¼ æ–‡ä»¶
                statusText.textContent = 'æ­£åœ¨ä¸Šä¼ å›¾ç‰‡...';
                const uploadResult = await uploadFile(selectedImageFile, 'image');
                
                if (uploadResult.code !== 0) {
                    throw new Error(uploadResult.msg || 'ä¸Šä¼ å¤±è´¥');
                }

                const fileName = uploadResult.data.fileName;
                showToast('ä¸Šä¼ æˆåŠŸ', 'success');

                // 2. åˆ›å»ºä»»åŠ¡
                statusText.textContent = 'æ­£åœ¨åˆ›å»ºä»»åŠ¡...';
                const taskResult = await createTask(fileName, 'image');
                
                if (taskResult.code !== 0) {
                    throw new Error(taskResult.msg || 'åˆ›å»ºä»»åŠ¡å¤±è´¥');
                }

                currentTaskId = taskResult.data.taskId;
                showToast('ä»»åŠ¡åˆ›å»ºæˆåŠŸ', 'success');

                // 3. è½®è¯¢çŠ¶æ€
                statusText.textContent = 'æ­£åœ¨å¤„ç†ä¸­...';
                const outputs = await pollTaskStatus(currentTaskId, (status) => {
                    statusText.textContent = `ä»»åŠ¡çŠ¶æ€: ${getStatusText(status)}`;
                });

                // 4. æ˜¾ç¤ºç»“æœ
                progressArea.classList.remove('show');
                displayImageResults(outputs);
                resultArea.classList.add('show');
                showToast('å¤„ç†å®Œæˆ', 'success');

            } catch (error) {
                progressArea.classList.remove('show');
                submitBtn.disabled = false;
                showToast(error.message || 'å¤„ç†å¤±è´¥', 'error');
                console.error(error);
            }
        }

        // APIè°ƒç”¨
        async function uploadFile(file, type) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('type', type);

            const response = await fetch('/api/upload', {
                method: 'POST',
                body: formData
            });

            return await response.json();
        }

        async function createTask(fileName, type, orientation = 'portrait') {
            const response = await fetch('/api/create_task', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ fileName, type, orientation })
            });

            return await response.json();
        }

        async function queryStatus(taskId) {
            const response = await fetch('/api/query_status', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ taskId })
            });

            return await response.json();
        }

        async function getOutputs(taskId) {
            const response = await fetch('/api/get_outputs', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ taskId })
            });

            return await response.json();
        }

        // è½®è¯¢ä»»åŠ¡çŠ¶æ€
        async function pollTaskStatus(taskId, onStatusChange) {
            const maxRetries = 60;
            const interval = 5000; // 5ç§’

            for (let i = 0; i < maxRetries; i++) {
                const result = await queryStatus(taskId);
                
                if (result.code !== 0) {
                    throw new Error(result.msg || 'æŸ¥è¯¢çŠ¶æ€å¤±è´¥');
                }

                const status = result.data;
                onStatusChange(status);

                if (status === 'SUCCESS') {
                    const outputsResult = await getOutputs(taskId);
                    if (outputsResult.code === 0) {
                        return outputsResult.data;
                    }
                    throw new Error('è·å–è¾“å‡ºå¤±è´¥');
                } else if (status === 'FAILED') {
                    throw new Error('ä»»åŠ¡æ‰§è¡Œå¤±è´¥');
                }

                await new Promise(resolve => setTimeout(resolve, interval));
            }

            throw new Error('å¤„ç†è¶…æ—¶');
        }

        // æ˜¾ç¤ºç»“æœ
        function displayVideoResults(outputs) {
            const container = document.getElementById('video-result-list');
            container.innerHTML = '';

            outputs.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'result-item';
                
                const isVideo = item.fileType === 'mp4' || item.fileType === 'mov';
                const localUrl = item.localUrl || item.fileUrl;
                
                div.innerHTML = `
                    ${isVideo ? `
                        <video class="result-preview" controls>
                            <source src="${localUrl}" type="video/${item.fileType}">
                        </video>
                    ` : `
                        <img class="result-preview" src="${localUrl}" alt="ç»“æœ${index + 1}">
                    `}
                    <div class="result-actions">
                        <a href="${localUrl}" download class="btn-download">ä¸‹è½½ ${item.fileType.toUpperCase()}</a>
                    </div>
                `;
                
                container.appendChild(div);
            });

            document.getElementById('video-submit').disabled = false;
        }

        function displayImageResults(outputs) {
            const container = document.getElementById('image-result-list');
            container.innerHTML = '';

            outputs.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'result-item';
                
                const localUrl = item.localUrl || item.fileUrl;
                
                div.innerHTML = `
                    <img class="result-preview" src="${localUrl}" alt="ç»“æœ${index + 1}">
                    <div class="result-actions">
                        <a href="${localUrl}" download class="btn-download">ä¸‹è½½ ${item.fileType.toUpperCase()}</a>
                    </div>
                `;
                
                container.appendChild(div);
            });

            document.getElementById('image-submit').disabled = false;
        }

        // å·¥å…·å‡½æ•°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function getStatusText(status) {
            const statusMap = {
                'CREATE': 'åˆ›å»ºä¸­',
                'QUEUED': 'æ’é˜Ÿä¸­',
                'RUNNING': 'å¤„ç†ä¸­',
                'SUCCESS': 'å®Œæˆ',
                'FAILED': 'å¤±è´¥'
            };
            return statusMap[status] || status;
        }

        function showToast(message, type = 'info') {
            toast.textContent = message;
            toast.className = `toast ${type}`;
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
